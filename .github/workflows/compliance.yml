name: British Isles Care Home Compliance

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main ]

jobs:
  compliance-check:
    runs-on: ubuntu-latest
    name: ğŸ´ó §ó ¢ó ªó ¥ó ²ó ¿ğŸ‡®ğŸ‡²ğŸ‡¬ğŸ‡§ğŸ‡®ğŸ‡ª British Isles Compliance Validation
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      
    - name: Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '18'
        cache: 'npm'
        
    - name: Install dependencies
      run: npm ci
      
    - name: ğŸ” Run British Isles Compliance Check
      run: npm run compliance:check
      
    - name: ğŸ“‹ Generate Compliance Report
      if: always()
      run: npm run compliance:report
      
    - name: ğŸ“„ Upload Compliance Report
      if: always()
      uses: actions/upload-artifact@v3
      with:
        name: british-isles-compliance-report
        path: reports/british-isles-compliance-report.md
        
    - name: âŒ Fail on Compliance Issues
      if: failure()
      run: |
        echo "ğŸš¨ COMPLIANCE FAILURE: British Isles care home regulations not met"
        echo "Review the compliance report for details"
        exit 1
        
  enterprise-build:
    runs-on: ubuntu-latest
    needs: compliance-check
    name: ğŸ† Enterprise Build (Post-Compliance)
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      
    - name: Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '18'
        cache: 'npm'
        
    - name: Install dependencies
      run: npm ci
      
    - name: ğŸ—ï¸ Enterprise Build
      run: npm run build
      
    - name: âœ… Validate Enterprise Services
      run: |
        echo "Validating core enterprise services..."
        npx tsc --noEmit --skipLibCheck src/hooks/useAnalytics.ts
        npx tsc --noEmit --skipLibCheck src/routes/organization/index.ts
        npx tsc --noEmit --skipLibCheck src/services/health/HealthService.ts
        npx tsc --noEmit --skipLibCheck src/utils/logger.ts
        echo "âœ… All enterprise services validated!"